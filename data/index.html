<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Spundomat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="theme.css" type="text/css">
</head>

<body onload="setInterval(refresh, 1000)">
  <div class="py-2">
    <div class="container">
      <div class="row">
        <div class="col">
          <h1 id="firmware" class="text-center"></h1>
        </div>
        <div class="col-md-auto">
          <a href="/edit" class="btn btn-outline-primary" id="btn_edit">Dateiexplorer</a>
          <button type="button" class="btn btn-outline-primary" id="btn_kalibrieren">Kalibrierung</button>
          <button type="button" class="btn btn-outline-primary" id="btn_visual">Visualisierung</button>
          <button type="button" class="btn btn-outline-danger" id="btn_update">Update</button>
          <button type="button" class="btn btn-outline-dark" id="btn_reboot">Neustart</button>
        </div>
      </div>
    </div>
  </div>
  <div class="py-2">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">Spundomat Dashboard <a href="" class="badge badge-warning"
                data-target="#misc_modal" data-toggle="modal" data-value="-1" style="float:right">Bearbeiten</a>
            </div>
            <div class="card-body">
              <ul class="list-group" id="miscSettings"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="misc_modal">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Einstellungen</h5> <button type="button" class="close"
            data-dismiss="modal"><span>×</span></button>
        </div>
        <div class="modal-body">
          <ul class="nav nav-tabs" id="miscTab" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="misc1-tab" data-toggle="tab" href="#misc1" role="tab" aria-controls="misc1"
                aria-selected="true">Spundomat</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="misc2-tab" data-toggle="tab" href="#misc2" role="tab" aria-controls="misc2"
                aria-selected="true">Hardware</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="misc3-tab" data-toggle="tab" href="#misc3" role="tab" aria-controls="misc3"
                aria-selected="true">System</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="misc5-tab" data-toggle="tab" href="#misc5" role="tab" aria-controls="misc5"
                aria-selected="true">Grafana</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="misc4-tab" data-toggle="tab" href="#misc4" role="tab" aria-controls="misc4"
                aria-selected="true">Restore</a>
            </li>
          </ul>
          <div class="tab-content" id="miscTabContent">
            <div class="tab-pane fade show active" id="misc1" role="tabpanel" aria-labelledby="misc1-tab">
              <br />
              <div class="form-group">
                <label for="modal_misc_modus">Modus</label>
                <select class="form-control" id="modal_misc_modus"></select>
              </div>
              <div class="form-group">
                <label for="modal_misc_pressure">Zielwert Druck (bar)</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_pressure" />
              </div>
              <div class="form-group">
                <label for="modal_misc_carbonation">Zielwert CO2 Gehalt (gr/l)</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_carbonation" />
              </div>
              <div class="form-group">
                <label for="modal_misc_kombi">Verzögerung Karbonisieren im Spundomat-Modus</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_kombi" />
                <label for="modal_misc_kombi_auswahl">Einheit für Verzögerung</label>
                <select class="form-control" id="modal_misc_kombi_auswahl"></select>
              </div>
            </div>
            <div class="tab-pane fade" id="misc2" role="tabpanel" aria-labelledby="misc2-tab">
              <br />
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="modal_misc_mv1" />
                <label class="form-check-label" for="modal_misc_mv1">Aktiviere MV1 (Spunden)</label>
              </div>
              <div class="form-group">
                <label for="modal_misc_mv1open">Öffne MV1 (Spunden) - ms</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_mv1open" />
              </div>
              <div class="form-group">
                <label for="modal_misc_mv1close">Schließe MV1 (Spunden) - ms</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_mv1close" />
              </div>
              <br />
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="modal_misc_mv2" />
                <label class="form-check-label" for="modal_misc_mv2">Aktiviere MV2 (Karbonisieren)</label>
              </div>
              <div class="form-group">
                <label for="modal_misc_mv2open">Öffne MV2 (Karbonisieren) - ms</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_mv2open" />
              </div>
              <div class="form-group">
                <label for="modal_misc_mv2close">Schließe MV2 (Karbonisieren) - ms</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_mv2close" />
              </div>
              <br />
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="modal_misc_buzzer" />
                <label class="form-check-label" for="modal_misc_buzzer">Aktiviere Buzzer Alarm</label>
              </div>
            </div>
            <div class="tab-pane fade" id="misc3" role="tabpanel" aria-labelledby="misc3-tab">
              <br />
              <div class="form-group">
                <label for="modal_misc_intervall_pressure">Intervall lese Drucksensor - ms</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_interval_pressure" />
              </div>
              <div class="form-group">
                <label for="modal_misc_intervall_temp">Intervall lese Temperatursensor - ms</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_interval_temp" />
              </div>
              <br />
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="modal_misc_mdns" />
                <label class="form-check-label" for="modal_misc_mdns">Aktiviere mDNS (Neustart erforderlich)</label>
              </div>
              <div class="form-group">
                <label for="modal_misc_mdns_name">Eindeutiger mDNS Name</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_mdns_name" />
              </div>
              <br />
            </div>
            <div class="tab-pane fade" id="misc5" role="tabpanel" aria-labelledby="misc5-tab">
              <br />
              <label class="form-check-label">Visualisierung Spundomat Daten</label>
              <br />
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="modal_misc_db_enable" />
                <label class="form-check-label" for="modal_misc_db_enable">Aktiviere Grafana (Neustart
                  erforderlich!)</label>
              </div>
              <div class="form-group">
                <label for="modal_misc_db_server">Influx Datenbank Server IP:Port (http://192.168.1.10:8086)</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_db_server" />
              </div>
              <div class="form-group">
                <label for="modal_misc_db_database">Datenbank Name</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_db_database" />
              </div>
              <div class="form-group">
                <label for="modal_misc_db_user">Datenbank Benutzer</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_db_user" />
              </div>
              <div class="form-group">
                <label for="modal_misc_db_pass">Datenbank Benutzer Password</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_db_pass" />
              </div>
              <div class="form-group">
                <label for="modal_misc_db_up">Update Intervall Datenbank in sek</label>
                <input type="text" class="form-control" placeholder="" id="modal_misc_db_up" />
              </div>
            </div>
            <div class="tab-pane fade" id="misc4" role="tabpanel" aria-labelledby="misc4-tab">
              <br />
              <label class="form-check-label">Reset Spundomat</label>
              <br />
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="modal_misc_eeprom" />
                <label class="form-check-label" for="modal_misc_eeprom">Lösche Kalibrierung</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="modal_misc_reset" />
                <label class="form-check-label" for="modal_misc_reset">Lösche WiFi (Reset to AP Mode)</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="modal_misc_clear" />
                <label class="form-check-label" for="modal_misc_clear">Lösche alle Einstellungen (Reset to
                  defaults)</label>
              </div>
			  <br />
              <label class="form-check-label">Debug - nicht aktivieren!</label>
              <br />
			  <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="modal_misc_testmode" />
                <label class="form-check-label" for="modal_misc_testmode">debug mode</label>
              </div>
			  <br />
            </div>
          </div>
        </div>
        <div class="modal-footer"> <button type="button" class="btn btn-primary"
            id="modal_misc_btn_save">Speichern</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Schließen</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true"
    id="mi-modal-upd">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabelUpd">Firmware Update</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
              aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body">
          <p>Datei Upload oder Web Update?</p>
          <p>Spundomat startet automatisch neu!</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" id="modal-btn-file">Upload</button>
          <button type="button" class="btn btn-secondary" id="modal-btn-web">WebUpdate</button>
          <button type="button" class="btn btn-primary" id="modal-btn-abbruch">Zurück</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabelVis" aria-hidden="true"
    id="mi-modal-vis">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabelVis">Visualisierung</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
              aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="modal_misc_vis_tag">Sud-ID für Visualisierung</label>
            <input type="text" class="form-control" placeholder="" id="modal_misc_vis_tag" />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" id="modal-btn-start">Starten</button>
          <button type="button" class="btn btn-primary" id="modal-btn-stop">Stoppen</button>
        </div>
      </div>
    </div>
  </div>
  <script src="./jquery-3.4.1.min.js"></script>
  <script src="./bootstrap.bundle.js"></script>
  <script type="text/javascript">


    function refresh() {
      $.get("/reqMiscSet", function (data) {
        let miscRender = "<li class='list-group-item d-flex justify-content-between align-items-center'>Aktueller Modus";
		if (data.mode == 0) {
			miscRender += "<span class='badge badge-info'>";
		}
		else {
			miscRender += "<span class='badge badge-success'>";
		}
		if (data.mode == 0) {
          miscRender += "Aus";
          miscRender += "</span></li><li class='list-group-item d-flex justify-content-between align-items-center'>Zielwert Druck<span class='badge badge-info'>";
          miscRender += data.pressure + " bar";
          miscRender += "</span></li> <li class='list-group-item d-flex justify-content-between align-items-center'>Zielwert CO2 Gehalt<span class='badge badge-info'>";
          miscRender += data.carbonation + " gr/l";
          miscRender += "</span></li>";
        }
        else if (data.mode == 1) {
          if (data.einheit < 2 && data.restverz != "0") {
			miscRender += "Spundomat " + data.restverz;
		  }
		  else
		  {
		    miscRender += "Spundomat";
		  }
          miscRender += "</span></li> <li class='list-group-item d-flex justify-content-between align-items-center'>Zielwert CO2 Gehalt<span class='badge badge-info'>";
          miscRender += data.carbonation + " gr/l";
          miscRender += "</span></li><li class='list-group-item d-flex justify-content-between align-items-center'>Verzögerung Karbonisierung<span class='badge badge-info'>";
          miscRender += data.delayspund;
		  if (data.einheit == 0) {
            miscRender += " min";
          }
          else if (data.einheit == 1) {
            miscRender += " h";
          }
          else {
            miscRender += " gr/l";
          }
          miscRender += "</span></li>";
        }
        else if (data.mode == 2) {
          miscRender += "Spunden CO2-Gehalt";
          miscRender += "</span></li> <li class='list-group-item d-flex justify-content-between align-items-center'>Zielwert CO2 Gehalt<span class='badge badge-info'>";
          miscRender += data.carbonation + " gr/l";
          miscRender += "</span></li>";
        }
        else if (data.mode == 3) {
          miscRender += "Spunden Druck";
          miscRender += "</span></li><li class='list-group-item d-flex justify-content-between align-items-center'>Zielwert Druck<span class='badge badge-info'>";
          miscRender += data.pressure + " bar";
          miscRender += "</span></li>";
        }
        else if (data.mode == 4) {
          miscRender += "Karbonisieren CO2-Gehalt";
          miscRender += "</span></li> <li class='list-group-item d-flex justify-content-between align-items-center'>Zielwert CO2 Gehalt<span class='badge badge-info'>";
          miscRender += data.carbonation + " gr/l";
          miscRender += "</span></li>";
        }
        else if (data.mode == 5) {
          miscRender += "Karbonisieren Druck";
          miscRender += "</span></li><li class='list-group-item d-flex justify-content-between align-items-center'>Zielwert Druck<span class='badge badge-info'>";
          miscRender += data.pressure + " bar";
          miscRender += "</span></li>";
        }
		else if (data.mode == 9) {
		  if (data.restverz != "0") {
			miscRender += "Überprüfe Dichtheit " + data.restverz;
		  }
		  else {
		    miscRender += "Überprüfe Dichtheit";
		  }
          miscRender += "</span></li><li class='list-group-item d-flex justify-content-between align-items-center'>Zielwert Druck<span class='badge badge-info'>";
          miscRender += data.pressure + " bar";
          miscRender += "</span></li>";
        }
        else {
          miscRender += "Ablaufplan #" + data.ablauf;
		  miscRender += "</span></li><li class='list-group-item d-flex justify-content-between align-items-center'>Zielwert Druck<span class='badge badge-info'>";
          miscRender += data.pressure + " bar";
          miscRender += "</span></li>";
        }
		miscRender += "<br/>";
        miscRender += "<li class='list-group-item d-flex justify-content-between align-items-center'> Aktueller Druck<span class='badge badge-light'>";
        if (data.druck == -1) {
          miscRender += "kein Drucksensor angeschlossen";
        }
        else {
          miscRender += data.druck + " bar";
        }
        miscRender += "</span></li> <li class='list-group-item d-flex justify-content-between align-items-center'> Aktueller CO2 Gehalt<span class='badge badge-light'>";
        miscRender += data.co2 + " gr/l";
        miscRender += "</span></li> <li class='list-group-item d-flex justify-content-between align-items-center'>Aktuelle Temperatur<span class='badge badge-light'>";
        if (data.temperatur == -127) {
          miscRender += "kein Temperatursensor angeschlossen";
        }
        else {
          miscRender += data.temperatur + " °C";
        }

        miscRender += "</span></li><br/>";
        if (data.offset == "0" || data.offset2 == "0") {
          miscRender += "<li class='list-group-item d-flex justify-content-between align-items-center'>Spannung am Drucksensor<span class='badge badge-light'>";
          miscRender += data.voltage + " V";
          miscRender += "</span></li>";
        }

        if (data.offset == "0") {
          miscRender += "<li class='list-group-item d-flex justify-content-between align-items-center'>1. Kalibrierung bei 0 bar <span class='badge ";
          miscRender += " badge-danger'>Kalibrierung bei 0bar ausführen";
          miscRender += "</span></li>";
        }
        if (data.offset2 == "0") {
          miscRender += "<li class='list-group-item d-flex justify-content-between align-items-center'>2. Kalibrierung bei 2bar";
          miscRender += "<span class='badge >";
          miscRender += " badge-danger'>Kalibrierung bei 2bar ausführen";
          miscRender += "</span> </li> <br />";
        }
        miscRender += "<li class='list-group-item d-flex justify-content-between align-items-center'>Hardware<span class='badge ";
		if (data.buzzer) {
          miscRender += " badge-success'>Alarm aktiviert";
        }
        else {
          miscRender += " badge-dark'>Alarm deaktiviert";
        }
		miscRender += "</span><span class='badge ";
        if (data.mv1) {
          miscRender += " badge-success'>MV1: " + data.mv1opendisp + " / " + data.mv1closedisp;
        }
        else {
          miscRender += " badge-dark'>MV1 deaktiviert";
        }
        miscRender += "</span><span class='badge ";
        if (data.mv2) {
          miscRender += " badge-success'>MV2: " + data.mv2opendisp + " / " + data.mv2closedisp;
        }
        else {
          miscRender += " badge-dark'>MV2 deaktiviert";
        }
        miscRender += "</span> </li>";
        miscRender += "<li class='list-group-item d-flex justify-content-between align-items-center'>Dienste<span class='badge ";
		if (data.dichtheit == -127.0)
		{
			miscRender += " badge-dark'>Dichtheit nicht überprüft";
		}
		else
		{
			miscRender += " badge-secondary'>Dichtheit überprüft: " + data.dichtheit;
		}
		miscRender += "</span><span class='badge ";
		if (data.mdns) {
          miscRender += " badge-success align-items-'>mDNS: " + data.mdns_name;
        }
        else {
          miscRender += " badge-dark'>mDNS deaktiviert";
        }
		miscRender += "</span><span class='badge ";
		if (data.startdb) {
		  if (data.startvis) 
		  {
			if (data.visstate == 0) 
			{
				miscRender += " badge-success'>Visualisierung: " + data.vistag;
			}
			else
			{
				miscRender += " badge-danger'>Visualisierung: " + data.visstate;
			}
		  }
		  else
		  {
            miscRender += " badge-secondary'>Visualisierung pausiert";
		  }
        }
        else {
          miscRender += " badge-dark'>Visualisierung deaktiviert";
        }
        miscRender += "</span></li>";
        $('#miscSettings').html(miscRender);
		
		if (data.alertstate)
		{
		  alert("*** SYSINFO: WebUpdate abgeschlossen");
		  location.reload();
		}
      });
    }
	
    var modalConfirmVis = function (callback) {
      $("#btn_visual").on("click", function () {
        $("#mi-modal-vis").modal('show');
      });

      $("#modal-btn-start").on("click", function () {
        callback(true);
        $("#mi-modal-vis").modal('hide');
      });

      $("#modal-btn-stop").on("click", function () {
        callback(false);
        $("#mi-modal-vis").modal('hide');
      });
    };

    modalConfirmVis(function (confirm) {
      if (confirm) {
        // start
        var vistag = $('#modal_misc_vis_tag').val()
        $.ajax({
          url: '/visualisieren?vistag=' + vistag + '&startvis=1',
          type: 'POST',
          async: false,
          cache: false
        }).done(function (msg) {
          window.location.reload(true);
        });;
      }
      else {
        // stop
        var vistag = $('#modal_misc_vis_tag').val()
        $.ajax({
          url: '/visualisieren?vistag=' + vistag + '&startvis=0',
          type: 'POST',
          async: false,
          cache: false
        }).done(function (msg) {
          window.location.reload(true);
        });;
      }
    });

    var modalConfirmUpd = function (callback) {
      $("#btn_update").on("click", function () {
        $("#mi-modal-upd").modal('show');
      });

      $("#modal-btn-web").on("click", function () {
		document.getElementById("firmware").innerHTML = "WebUpdate gestartet ...";
		$("#mi-modal-upd").modal('hide');
		onload = setInterval(refresh, 120000);
        callback("1");
      });

      $("#modal-btn-file").on("click", function () {
        $("#mi-modal-upd").modal('hide');
        callback("2");
      });

      $("#modal-btn-abbruch").on("click", function () {
        callback("0");
        $("#mi-modal-upd").modal('hide');
      });
    };

    modalConfirmUpd(function (confirm) {
      if (confirm == "1") {
		$.ajax({
          url: '/startHTTPUpdate',
          type: 'POST',
          async: false,
          cache: false
        }).done(function (msg) {
          window.location.reload(true);
        });;
      }
      else if (confirm == "2") {
        location.href = "/update";
      }
    });

    $('#misc_modal').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget);
      var mdns;
      var mdns_name;
      var reset;
      var clear;
      var eeprom;
      var pressure;
      var carbonation;
      var mode;
      var delayspund;
	  var delayspunddisp;
      var einheit;
      var druck;
      var voltage;
      var temperatur;
      var co2;
      var offset;
      var mv1;
      var mv1open;
      var mv1close;
      var mv2;
      var mv2open;
      var mv2close;
	  var mv1opendisp;
      var mv1closedisp;
      var mv2opendisp;
      var mv2closedisp;
      var uppressure;
      var uptemp;
      var buzzer;
      var testmode;
      var offset2;
      var startdb;
	  var startvis;
	  var visstate;
      var dbserver;
      var dbdatabase;
      var dbuser;
      var dbpass;
      var dbup;
	  var ablauf;
	  var alertstate;

      $.ajax({
        url: '/reqMisc?req=mdns',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          mdns = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=mdns_name',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          mdns_name = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=pressure',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          pressure = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=carbonation',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          carbonation = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=mode',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          mode = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=verzkombi',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          delayspund = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=einheit',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          einheit = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=co2',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          co2 = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=voltage',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          voltage = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=temperatur',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          temperatur = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=druck',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          druck = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=offset',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          offset = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=offset2',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          offset2 = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=mv1',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          mv1 = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=mv1open',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          mv1open = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=mv1close',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          mv1close = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=mv2',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          mv2 = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=mv2open',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          mv2open = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=mv2close',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          mv2close = data;
        }
      });
	  $.ajax({
        url: '/reqMisc?req=mv1opendisp',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          mv1opendisp = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=mv1closedisp',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          mv1closedisp = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=mv2opendisp',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          mv2opendisp = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=mv2closedisp',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          mv2closedisp = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=uppressure',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          uppressure = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=uptemp',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          uptemp = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=buzzer',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          buzzer = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=testmode',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          testmode = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=dbserver',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          dbserver = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=startdb',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          startdb = data;
        }
      });
	  $.ajax({
        url: '/reqMisc?req=startvis',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          startvis = data;
        }
      });
	  $.ajax({
        url: '/reqMisc?req=visstate',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          visstate = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=dbdatabase',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          dbdatabase = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=dbuser',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          dbuser = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=dbpass',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          dbpass = data;
        }
      });
      $.ajax({
        url: '/reqMisc?req=dbup',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          dbup = data;
        }
      });
	  $.ajax({
        url: '/reqMisc?req=ablauf',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          ablauf = data;
        }
      });
	  $.ajax({
        url: '/reqMisc?req=alertstate',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          alertstate = data;
        }
      });
	  $.ajax({
        url: '/reqMisc?req=alertmessage',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          alertmessage = data;
        }
      });

      var modal = $(this);
      $('#modal_misc_modus').load('/reqMode');
      $('#modal_misc_kombi_auswahl').load('/reqEinheit');
      modal.find('#modal_misc_mdns_name').val(mdns_name);
      if (mdns == "1") { modal.find('#modal_misc_mdns').prop("checked", true); }
      else { modal.find('#modal_misc_mdns').prop("checked", false); }
      if (mv1 == "1") { modal.find('#modal_misc_mv1').prop("checked", true); }
      else { modal.find('#modal_misc_mv1').prop("checked", false); }
      if (mv2 == "1") { modal.find('#modal_misc_mv2').prop("checked", true); }
      else { modal.find('#modal_misc_mv2').prop("checked", false); }
      if (buzzer == "1") { modal.find('#modal_misc_buzzer').prop("checked", true); }
      else { modal.find('#modal_misc_buzzer').prop("checked", false); }
      if (testmode == "1") { modal.find('#modal_misc_testmode').prop("checked", true); }
      else { modal.find('#modal_misc_testmode').prop("checked", false); }
      if (startdb == "1") { modal.find('#modal_misc_db_enable').prop("checked", true); }
      else { modal.find('#modal_misc_db_enable').prop("checked", false); }
      modal.find('#modal_misc_reset').prop("checked", false);
      modal.find('#modal_misc_clear').prop("checked", false);
      modal.find('#modal_misc_eeprom').prop("checked", false);
      modal.find('#modal_misc_pressure').val(pressure);
      modal.find('#modal_misc_carbonation').val(carbonation);
      modal.find('#modal_misc_mv1open').val(mv1open);
      modal.find('#modal_misc_mv1close').val(mv1close);
      modal.find('#modal_misc_mv2open').val(mv2open);
      modal.find('#modal_misc_mv2close').val(mv2close);
      modal.find('#modal_misc_interval_pressure').val(uppressure);
      modal.find('#modal_misc_interval_temp').val(uptemp);
      modal.find('#modal_misc_kombi').val(delayspund);
      modal.find('#modal_misc_offset').val(offset);
      modal.find('#modal_misc_offset2').val(offset2);
      modal.find('#modal_misc_db_server').val(dbserver);
      modal.find('#modal_misc_db_database').val(dbdatabase);
      modal.find('#modal_misc_db_user').val(dbuser);
      modal.find('#modal_misc_db_pass').val(dbpass);
      modal.find('#modal_misc_db_up').val(dbup);
      var modal = $(this);
    });

    $("#modal_misc_btn_save").click(function () {
      var modal = $('#misc_modal');
      var mdns_name = modal.find('#modal_misc_mdns_name').val();
      var pressure = modal.find('#modal_misc_pressure').val();
      var carbonation = modal.find('#modal_misc_carbonation').val();
      // var mode = $('#modal_misc_modus option:selected').text();
      var mode = $('#modal_misc_modus').val();
      var einheit = $('#modal_misc_kombi_auswahl').val();
      var delayspund = modal.find('#modal_misc_kombi').val();
      var mv1open = modal.find('#modal_misc_mv1open').val();
      var mv1close = modal.find('#modal_misc_mv1close').val();
      var mv2open = modal.find('#modal_misc_mv2open').val();
      var mv2close = modal.find('#modal_misc_mv2close').val();
      var uppressure = modal.find('#modal_misc_interval_pressure').val();
      var uptemp = modal.find('#modal_misc_interval_temp').val();
      var dbserver = modal.find('#modal_misc_db_server').val();
      var dbdatabase = modal.find('#modal_misc_db_database').val();
      var dbuser = modal.find('#modal_misc_db_user').val();
      var dbpass = modal.find('#modal_misc_db_pass').val();
      var dbup = modal.find('#modal_misc_db_up').val();
      if (modal.find('#modal_misc_mdns').prop("checked") == true) {
        var mdns = "1";
      }
      else {
        var mdns = "0";
      }
      if (modal.find('#modal_misc_eeprom').prop("checked") == true) {
        var eeprom = "1";
      }
      else {
        var eeprom = "0";
      }
      if (modal.find('#modal_misc_reset').prop("checked") == true) {
        var reset = "1";
      }
      else {
        var reset = "0";
      }
      if (modal.find('#modal_misc_clear').prop("checked") == true) {
        var clear = "1";
      }
      else {
        var clear = "0";
      }
      if (modal.find('#modal_misc_mv1').prop("checked") == true) {
        var mv1 = "1";
      }
      else {
        var mv1 = "0";
      }
      if (modal.find('#modal_misc_mv2').prop("checked") == true) {
        var mv2 = "1";
      }
      else {
        var mv2 = "0";
      }
      if (modal.find('#modal_misc_buzzer').prop("checked") == true) {
        var buzzer = "1";
      }
      else {
        var buzzer = "0";
      }
      if (modal.find('#modal_misc_testmode').prop("checked") == true) {
        var testmode = "1";
      }
      else {
        var testmode = "0";
      }
      if (modal.find('#modal_misc_db_enable').prop("checked") == true) {
        var startdb = "1";
      }
      else {
        var startdb = "0";
      }

      $.ajax({
        url: '/setMisc?reset=' + reset + '&clear=' + clear + '&eeprom=' + eeprom + '&mdns=' + mdns + '&mdns_name=' + mdns_name + '&pressure=' + pressure + '&carbonation=' + carbonation + '&mode=' + mode + '&verzkombi=' + delayspund + '&einheit=' + einheit + '&mv1=' + mv1 + '&mv1open=' + mv1open + '&mv1close=' + mv1close + '&mv2=' + mv2 + '&mv2open=' + mv2open + '&mv2close=' + mv2close + '&uppressure=' + uppressure + '&uptemp=' + uptemp + '&buzzer=' + buzzer + '&testmode=' + testmode + '&startdb=' + startdb + '&dbserver=' + dbserver + '&dbdatabase=' + dbdatabase + '&dbuser=' + dbuser + '&dbpass=' + dbpass + '&dbup=' + dbup,
        type: 'POST',
        dataType: 'html',
        async: false,
        cache: false
      });
      modal.modal('hide')
    });

    $("#btn_reboot").click(function () {
      $.ajax({
        url: '/reboot',
        type: 'POST',
        async: false,
        cache: false
      }).done(function (msg) {
        //alert("Device says: " + msg + "\n Page will be reloaded now!");
        window.location.reload(true);
      });;
    });

    $("#btn_kalibrieren").click(function () {
      $.ajax({
        url: '/kalibrieren',
        type: 'POST',
        async: false,
        cache: false
      }).done(function (msg) {
        window.location.reload(true);
      });;
    });
	
    $(function () {
      var firmware;
      $.ajax({
        url: '/reqMisc?req=firmware',
        type: 'get',
        dataType: 'html',
        async: false,
        cache: false,
        success: function (data) {
          firmware = data;
        }
      });
      document.getElementById("firmware").innerHTML = firmware;
    });

  </script>
</body>

</html>